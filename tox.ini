[tox]
envlist = py-{pylint,flake8,isort,rstlint,pydiatra,pydocstyle,pytest,black,bandit,mypy}
skipsdist = True
isolated_build = true

[testenv]
basepython = python3.11
setenv =
    PYTHONPATH = src
sitepackages = false
envdir =
    py-pylint: {toxworkdir}/py-pylint
    py-pytest: {toxworkdir}/py-pytest
    py-flake8: {toxworkdir}/py-flake8
    py-isort: {toxworkdir}/py-isort
    py-rstlint: {toxworkdir}/py-rstlint
    py-pydiatra: {toxworkdir}/py-pydiatra
    py-pydocstyle: {toxworkdir}/py-pydocstyle
    py-black: {toxworkdir}/py-black
    py-bandit: {toxworkdir}/py-bandit
    py-mypy: {toxworkdir}/py-mypy
allowlist_externals =
    make
    echo
    poetry

commands_pre =
    poetry install --no-root

commands =
    requirements: echo "Install requirements"
    flake8: flake8 src
    pylint: pylint src
    pydiatra: make pydiatra-script
    isort: isort --check-only --diff src
    bandit: bandit -r src --exclude src/{env:APP}/tests
    pydocstyle: pydocstyle src --count
    #safety: safety check
    pytest: py.test src
    rstlint: rst-lint README.rst doc.rst
    black: black src --check
    mypy: mypy src --explicit-package-bases
