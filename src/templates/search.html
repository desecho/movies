{% extends 'base.html' %}

{% block content %}
  <div v-cloak id="search">
    <form @submit.prevent="search" class="mt-1 col-lg-7 col-md-8 col-sm-10 col-xl-5 mx-auto">
      <div class="input-group">
        <input class="form-control" type="text" autofocus v-model="query" required>
        <div class="input-group-append search-btn-group">
          <button class="btn btn-secondary" type="submit">{% translate 'Search' %}</button>
          <button
            class="search-type-button btn btn-secondary dropdown-toggle"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            [[ searchType ]] <span class="caret"></span>
          </button>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="javascript:void(0)" @click="changeSearchType('movie');">
              {% translate 'Movie' %}
            </a>
            <a class="dropdown-item" href="javascript:void(0)" @click="changeSearchType('actor');">
              {% translate 'Actor' %}
            </a>
            <a class="dropdown-item" href="javascript:void(0)" @click="changeSearchType('director');">
              {% translate 'Director' %}
            </a>
          </div>
        </div>
      </div>
      <div class="search-panel-additional">
        <div>
          <label class="checkbox">
            <input type="checkbox" v-model="popularOnly"> {% translate 'show only popular' %}
          </label>
        </div>
        <div>
          <label class="checkbox">
            <input type="checkbox" v-model="sortByDate"> {% translate 'sort by date' %}
          </label>
        </div>
      </div>
    </form>
    <div class="results" v-cloak>
      <div class="movie" v-show="!movie.hide" v-for="movie in movies">
        <div class="poster-wrapper">
          <div class="poster">
            <div class="add-to-list-buttons">
              <a
                href="javascript:void(0)"
                @click="addToListFromDb(movie, listWatchedId)"
                title="{% translate 'Add to the list' %} {% translate 'Watched' %}"
                v-show="movie.isReleased"
              >
                <font-awesome-icon icon="fa-solid fa-eye" />
              </a>
              <a href="javascript:void(0)" title="{% translate 'Add to the list' %} {% translate 'To Watch' %}"
                @click="addToListFromDb(movie, listToWatchId)"><font-awesome-icon icon="fa-solid fa-eye-slash" /></a>
            </div>
            <a :href="movie.tmdbLink" target="_blank">
              <v-lazy-image
                :srcset="getSrcSet(movie.poster, movie.poster2x)"
                :src="movie.poster2x"
                :title="movie.titleOriginal"
                :alt="movie.title"
              />
            </a>
          </div>
        </div>
        <div class="movie-content">
          <div class="title">[[ movie.title ]]</div>
          <div class="details" v-show="movie.releaseDate">
            [[ movie.releaseDate ]]
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block js %}
  <script>
    'use strict';

    urls.searchMovie = '{% url 'search_movie' %}';
    urls.addToListFromDb = '{% url 'add_to_list_from_db' %}';
  </script>
  <script src="{% static 'js/search.js' %}"></script>
{% endblock %}
