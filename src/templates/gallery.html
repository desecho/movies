{% extends 'base.html' %}

{% block content %}
  {% include 'includes/movie_count.html' %}
  <div class="row">
    <div class="col-sm-12 mb-2">
      <a
        class="btn btn-secondary"
        {% if anothers_account %}
          href="{% url 'list' anothers_account.username list %}"
        {% else %}
          href="{% url 'list' list %}"
        {% endif %}
      >
        {% translate 'List' %}
      </a>
    </div>
    <div class="col-sm-12 mb-2">
      <div class="btn-group btn-group-toggle" data-toggle="buttons">
        <label
          class="btn btn-secondary" :class="{active: listId == listWatchedId}"
          @click="openUrl(urls.galleryWatched)"
          title="{% translate 'Watched' %}"
        >
          <input type="radio" :checked="listId == listWatchedId">
          {% translate 'Watched' %}
        </label>
        <label
          class="btn btn-secondary" :class="{active: listId == listToWatchId}"
          @click="openUrl(urls.galleryToWatch)"
          title="{% translate 'To Watch' %}"
        >
          <input type="radio" :checked="listId == listToWatchId">
          {% translate 'To Watch' %}
        </label>
      </div>
    </div>
  </div>
  <draggable
    v-model="records"
    @sort="saveRecordsOrder"
    item-key="id"
    :disabled="!isSortable"
  >
    <template #item="{element, index}">
      <div class="gallery-record">
        <button
          type="button"
          class="btn btn-secondary up-button"
          @click="moveToTop(element, index)"
          title="{% translate 'Move to the top' %}"
          v-show="isSortable"
        >
          <font-awesome-icon icon="fa-solid fa-arrow-up" />
        </button>
        <button
          type="button"
          class="btn btn-secondary down-button"
          @click="moveToBottom(element, index)"
          title="{% translate 'Move to the bottom' %}"
          v-show="isSortable"
        >
          <font-awesome-icon icon="fa-solid fa-arrow-down" />
        </button>
        <v-lazy-image
          class="poster-big" :class="{draggable: isSortable}"
          :srcset="getSrcSet(element.movie.posterNormal, element.movie.posterBig)"
          :src="element.movie.posterBig"
          :title="element.movie.titleOriginal"
          :alt="element.movie.title"
        />
      </div>
    </template>
{% endblock %}

{% block js %}
  <script>
    'use strict';

    vars.records = JSON.parse('{{ records|escapejs|safe }}');
    vars.isAnothersAccount = {{ anothers_account|yesno:'true,false' }};
    vars.listId = {{ list_id }};
    {% if anothers_account %}
      urls.galleryWatched = '{% url 'gallery' anothers_account.username 'watched' %}';
      urls.galleryToWatch = '{% url 'gallery' anothers_account.username 'to-watch' %}';
    {% else %}
      urls.galleryWatched = '{% url 'gallery' 'watched' %}';
      urls.galleryToWatch = '{% url 'gallery' 'to-watch' %}';
    {% endif %}
    urls.saveRecordsOrder = '{% url 'save_records_order' %}';
  </script>
  <script src="{% static 'js/gallery.js' %}"></script>
{% endblock %}
